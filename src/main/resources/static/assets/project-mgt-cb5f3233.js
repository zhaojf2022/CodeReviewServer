
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{R as p,S as V,N as o,n as R,a as n,o as y,c as v,f as e,g as t,i as d,b as g,M as O,U as T,I as q,q as B,Q as A,_ as z,O as L}from"./index-04c83304.js";import{_ as W}from"./index-4ca463c3.js";const x={data(){return{showEditDialog:!1,showCreateDialog:!1,memberDialog:!1,batchBtnEnable:!1,search:{queryParams:{deptId:null}},departmentTree:{},projectList:[],listUsers:[],memberEditDetail:{},selectedRows:[],editDetail:{},createDetail:{},editFieldRules:{projectName:[{required:!0,message:"项目名称必填",trigger:"blur"}]}}},computed:{},mounted(){this.clickSearch(),this.loadDepartmentTree(),this.loadUserList()},methods:{loadProjects(){const r=this.search.queryParams.deptId?this.search.queryParams.deptId:-1;p.get(`server/project/queryProjectInDept?deptId=${r}`).then(l=>{this.projectList=l.data})},loadDepartmentTree(){p.get("server/dept/getDeptTree").then(r=>{this.departmentTree=r.data})},loadUserList(){p.get("server/user/getAllUserDetails").then(r=>{this.listUsers=r.data})},clickSearch(){this.loadProjects()},resetSearch(){this.search.queryParams={deptId:null},this.clickSearch()},getSelectedRows(r){this.selectedRows=r,this.selectedRows&&this.selectedRows.length!==0?this.batchBtnEnable=!0:this.batchBtnEnable=!1},deleteSelection(r){V.confirm("确定要删除所选项目吗？此操作不可恢复！","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const l=[];for(let c=0;c<this.selectedRows.length;c++){const j=this.selectedRows[c];l.push(j.id)}p.get(`server/project/deleteProjects?projectIds=${l}`).then(c=>{c.code===0?o({type:"success",message:"删除成功"}):o({type:"error",message:`删除失败：${c.message}`}),this.clickSearch()})}).catch(()=>{})},deleteSingle(r){V.confirm("确定要删除此项目吗？此操作不可恢复！","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{p.get(`server/project/deleteProject?projectId=${r.id}`).then(l=>{l.code===0?o({type:"success",message:"删除成功"}):o({type:"error",message:`删除失败：${l.message}`}),this.clickSearch()})}).catch(()=>{})},memberManage(r){p.get(`server/project/queryProjectMembers?projectId=${r.id}`).then(l=>{this.memberEditDetail={userMembers:l.data,projectId:`${r.id}`},this.memberDialog=!0}).catch(l=>{o({type:"error",message:`操作失败：${l}`})})},saveMemberOperation(r){this.$refs.memberDetailForm.validate(l=>{l?p.post("server/project/saveProjectMembers",{projectId:this.memberEditDetail.projectId,accounts:this.memberEditDetail.userMembers}).then(c=>{c.code===0?(o({type:"success",message:"保存成功"}),this.memberDialog=!1):o({type:"error",message:`编辑失败：${c.message}`})}):o({type:"error",message:"参数内容填写有误，请检查"})})},cancelMemberOperation(r){this.memberDialog=!1},editSingle(r){p.get(`server/project/queryProject?projectId=${r.id}`).then(l=>{this.editDetail={projectName:l.data.projectName,projectDesc:l.data.projectDesc,departmentId:l.data.department.id,id:l.data.id},this.showEditDialog=!0}).catch(l=>{o({type:"error",message:`编辑失败：${l}`})})},saveEditOperation(){this.$refs.editDetailForm.validate(r=>{r?p.post(`server/project/modifyProject?projId=${this.editDetail.id}`,this.editDetail).then(l=>{l.code===0?(o({type:"success",message:"保存成功"}),this.showEditDialog=!1,this.clickSearch()):o({type:"error",message:`编辑失败：${l.message}`})}):o({type:"error",message:"参数内容填写有误，请检查"})})},cancelEditOperation(){this.showEditDialog=!1},create(){this.createDetail={projectName:"",projectDesc:""},this.showCreateDialog=!0},cancelCreateOperation(){this.showCreateDialog=!1},saveCreateOperation(){this.$refs.createDetailForm.validate(r=>{r?p.post("server/project/createProject",this.createDetail).then(l=>{l.code===0?(o({type:"success",message:"保存成功"}),this.showCreateDialog=!1,this.clickSearch()):o({type:"error",message:`保存失败：${l.message}`})}):o({type:"error",message:"参数内容填写有误，请检查"})})}}};const Q={class:"button-group"},G={class:"dialog-footer"},H={class:"dialog-footer"},J={class:"dialog-footer"};function K(r,l,c,j,a,s){const I=A,D=n("el-tree-select"),m=n("el-form-item"),_=n("el-col"),b=z,F=n("el-icon"),i=n("el-button"),S=n("el-row"),E=n("el-form"),U=W,w=L,f=n("el-table-column"),M=n("el-table"),h=n("el-input"),C=n("el-dialog"),N=n("el-option"),P=n("el-select");return y(),v("div",null,[e(I,{title:"项目管理",content:"本页面提供对系统内所有的项目信息进行维护，项目需要绑定到部门，支持按照部门维度筛选自己部门内的项目列表。"}),e(w,{title:"搜索条件"},{default:t(()=>[e(U,null,{default:t(()=>[e(E,{model:a.search,size:"default","label-width":"120px"},{default:t(()=>[e(S,null,{default:t(()=>[e(_,{span:6},{default:t(()=>[e(m,{label:"归属部门"},{default:t(()=>[e(D,{clearable:"",modelValue:a.search.queryParams.deptId,"onUpdate:modelValue":l[0]||(l[0]=u=>a.search.queryParams.deptId=u),data:a.departmentTree,"render-after-expand":!1,"check-strictly":"true"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(i,{type:"primary",onClick:s.clickSearch},{icon:t(()=>[e(F,null,{default:t(()=>[e(b,{name:"ep:search"})]),_:1})]),default:t(()=>[d(" 查询 ")]),_:1},8,["onClick"]),e(i,{onClick:s.resetSearch},{default:t(()=>[d(" 重置 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(w,null,{default:t(()=>[g("div",Q,[e(i,{type:"primary",onClick:s.create},{icon:t(()=>[e(F,null,{default:t(()=>[e(b,{name:"ep:circle-plus"})]),_:1})]),default:t(()=>[d(" 新建 ")]),_:1},8,["onClick"]),e(i,{type:"danger",disabled:!a.batchBtnEnable,onClick:s.deleteSelection},{icon:t(()=>[e(F,null,{default:t(()=>[e(b,{name:"ep:delete"})]),_:1})]),default:t(()=>[d(" 删除所选 ")]),_:1},8,["disabled","onClick"])]),e(M,{border:"","highlight-current-row":"",data:a.projectList,height:"100%",onSelectionChange:s.getSelectedRows},{default:t(()=>[e(f,{type:"selection",width:"55"}),e(f,{fixed:"",prop:"id",label:"项目ID",width:"100"}),e(f,{prop:"projectName",label:"项目名称",width:"360"}),e(f,{prop:"department.name",label:"归属部门",width:"200"}),e(f,{prop:"projectDesc",label:"项目描述"}),e(f,{fixed:"right",label:"操作",width:"200"},{default:t(u=>[e(i,{link:"",type:"primary",size:"small",onClick:k=>s.memberManage(u.row)},{default:t(()=>[d(" 成员管理 ")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",size:"small",onClick:k=>s.editSingle(u.row)},{default:t(()=>[d(" 编辑 ")]),_:2},1032,["onClick"]),e(i,{link:"",type:"danger",size:"small",onClick:k=>s.deleteSingle(u.row)},{default:t(()=>[d(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),_:1}),e(C,{modelValue:a.showEditDialog,"onUpdate:modelValue":l[5]||(l[5]=u=>a.showEditDialog=u),title:"编辑项目信息"},{footer:t(()=>[g("span",G,[e(i,{onClick:s.cancelEditOperation},{default:t(()=>[d(" 取消 ")]),_:1},8,["onClick"]),e(i,{type:"primary",onClick:s.saveEditOperation},{default:t(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:t(()=>[e(E,{ref:"editDetailForm",model:a.editDetail,size:"default","label-width":"120px",rules:a.editFieldRules},{default:t(()=>[e(_,{span:18},{default:t(()=>[e(m,{label:"项目ID"},{default:t(()=>[e(h,{modelValue:a.editDetail.id,"onUpdate:modelValue":l[1]||(l[1]=u=>a.editDetail.id=u),readonly:"",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:18},{default:t(()=>[e(m,{label:"项目名称",prop:"projectName",rules:a.editFieldRules.projectName},{default:t(()=>[e(h,{modelValue:a.editDetail.projectName,"onUpdate:modelValue":l[2]||(l[2]=u=>a.editDetail.projectName=u),placeholder:"输入项目的名称",maxlength:"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(_,{span:24},{default:t(()=>[e(m,{label:"归属部门"},{default:t(()=>[e(D,{modelValue:a.editDetail.departmentId,"onUpdate:modelValue":l[3]||(l[3]=u=>a.editDetail.departmentId=u),data:a.departmentTree,"render-after-expand":!1,"check-strictly":"true"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(_,{span:18},{default:t(()=>[e(m,{label:"项目描述"},{default:t(()=>[e(h,{modelValue:a.editDetail.projectDesc,"onUpdate:modelValue":l[4]||(l[4]=u=>a.editDetail.projectDesc=u),type:"textarea",rows:3,placeholder:"输入项目的简要描述信息",clearable:"",maxlength:"32","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(C,{modelValue:a.showCreateDialog,"onUpdate:modelValue":l[9]||(l[9]=u=>a.showCreateDialog=u),title:"创建项目信息"},{footer:t(()=>[g("span",H,[e(i,{onClick:s.cancelCreateOperation},{default:t(()=>[d(" 取消 ")]),_:1},8,["onClick"]),e(i,{type:"primary",onClick:s.saveCreateOperation},{default:t(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:t(()=>[e(E,{ref:"createDetailForm",model:a.createDetail,size:"default","label-width":"120px",rules:a.editFieldRules},{default:t(()=>[e(_,{span:18},{default:t(()=>[e(m,{label:"项目名称",prop:"projectName",rules:a.editFieldRules.projectName},{default:t(()=>[e(h,{modelValue:a.createDetail.projectName,"onUpdate:modelValue":l[6]||(l[6]=u=>a.createDetail.projectName=u),placeholder:"输入项目的名称",maxlength:"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(_,{span:24},{default:t(()=>[e(m,{label:"归属部门"},{default:t(()=>[e(D,{modelValue:a.createDetail.departmentId,"onUpdate:modelValue":l[7]||(l[7]=u=>a.createDetail.departmentId=u),data:a.departmentTree,"render-after-expand":!1,"check-strictly":"true"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(_,{span:18},{default:t(()=>[e(m,{label:"项目描述"},{default:t(()=>[e(h,{modelValue:a.createDetail.projectDesc,"onUpdate:modelValue":l[8]||(l[8]=u=>a.createDetail.projectDesc=u),type:"textarea",rows:3,placeholder:"输入项目的简要描述信息",clearable:"",maxlength:"32","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(C,{modelValue:a.memberDialog,"onUpdate:modelValue":l[11]||(l[11]=u=>a.memberDialog=u),title:"管理项目成员"},{footer:t(()=>[g("span",J,[e(i,{onClick:s.cancelMemberOperation},{default:t(()=>[d(" 取消 ")]),_:1},8,["onClick"]),e(i,{type:"primary",onClick:s.saveMemberOperation},{default:t(()=>[d(" 保存 ")]),_:1},8,["onClick"])])]),default:t(()=>[e(E,{ref:"memberDetailForm",model:a.memberEditDetail,size:"default","label-width":"120px"},{default:t(()=>[e(_,{span:24},{default:t(()=>[e(m,{label:"项目成员"},{default:t(()=>[e(P,{modelValue:a.memberEditDetail.userMembers,"onUpdate:modelValue":l[10]||(l[10]=u=>a.memberEditDetail.userMembers=u),multiple:"",placeholder:"Select",style:{width:"800px"}},{default:t(()=>[(y(!0),v(O,null,T(a.listUsers,u=>(y(),q(N,{key:u.account,label:u.name,value:u.account},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}typeof B=="function"&&B(x);const Z=R(x,[["render",K],["__scopeId","data-v-1c41b661"]]);export{Z as default};
//# sourceMappingURL=project-mgt-cb5f3233.js.map
